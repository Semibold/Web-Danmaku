/*! @preserve web-danmaku: 1.0.0-8ddf605 (2021-03-25T09:38:22.202Z) */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";i.r(e),i.d(e,"Danmaku",(function(){return m}));var n=function(){function t(t){this.text=t,this.domParser=new DOMParser,this.disinfectedText=this.text.replace(/[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]/g,""),this.doc=this.domParser.parseFromString(this.disinfectedText,"text/xml")}return t.prototype.getSingleNodeStringContent=function(t){var e=this.doc.querySelector(t);if(e&&null!=e.textContent)return e.textContent},t.prototype.getSingleNodeNumberContent=function(t){var e=this.doc.querySelector(t);if(e&&e.textContent)return Number(e.textContent)},t.prototype.getVarietyDanmakuItems=function(t){var e=[],i=this.doc.getElementsByTagName(t);if(!i)return e;for(var n=0;n<i.length;n++){var r=i[n],o=r.textContent;if(o){var s=r.getAttribute("p");if(s){var a=s.split(",");if(!(a.length<8)){var h={start:Number(a.shift()),mode:Number(a.shift()),size:Number(a.shift()),color:Number(a.shift()),pubDate:Number(a.shift()),pool:Number(a.shift()),uHash:String(a.shift()),uuid:String(a.shift()),content:o};e.push(h)}}}}return e},t.prototype.parse=function(){var t={};return t.chatServer=this.getSingleNodeStringContent("chatserver"),t.chatId=this.getSingleNodeStringContent("chatid"),t.mission=this.getSingleNodeStringContent("mission"),t.maxLimit=this.getSingleNodeNumberContent("maxlimit"),t.source=this.getSingleNodeStringContent("source"),t.ds=this.getSingleNodeStringContent("ds"),t.de=this.getSingleNodeStringContent("de"),t.maxCount=this.getSingleNodeNumberContent("max_count"),t.items=this.getVarietyDanmakuItems("d"),t},t}(),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}Object.create;function s(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s}function h(t,e){for(var i=0,n=e.length,r=t.length;i<n;i++,r++)t[r]=e[i];return t}Object.create;var l=1.125,c=function(){function t(){}return t.danmakuCompareFn=function(t,e){return t.start-e.start},t.getMeasuredTextWidth=function(t,e,i){void 0===i&&(i="normal normal normal normal 1rem/1.125 sans-serif");var n=t.getContext("2d");return n?(n.font=i,n.measureText(e).width):0},t.getHexColor=function(t,e){void 0===e&&(e=!0);var i=("000000"+t.toString(16)).slice(-6);return e?"#"+i:i},t.getOutlineColor=function(t){return t?0:16777215},t.isOrthogonalRectangle=function(t,e){var i=t.x+t.width/2,n=t.y+t.height/2,r=e.x+e.width/2,o=e.y+e.height/2;return Math.abs(i-r)<=(t.width+e.width)/2&&Math.abs(n-o)<=(t.height+e.height)/2},t}(),u=function(){function t(t){this.entries=[],this.compareFn=t}return t.prototype.bSearchTargetIndex=function(t){for(var e=0,i=0,n=this.entries.length-1;e<=n;){i=Math.floor((e+n)/2);var r=this.compareFn(t,this.entries[i]);if(r<0)n=i-1;else{if(!(r>0))return i;e=i+1}}return-1},t.prototype.bSearchInsertionIndex=function(t){if(!this.entries.length)return 0;if(this.compareFn(t,this.entries[0])<=0)return 0;if(this.compareFn(t,this.entries[this.entries.length-1])>=0)return this.entries.length;for(var e=0,i=0,n=this.entries.length-1;e<=n;){i=Math.floor((e+n+1)/2);var r=this.compareFn(t,this.entries[i-1]),o=this.compareFn(t,this.entries[i]);if(r>=0&&o<=0)return i;if(r<0)n=i-1;else{if(!(r>0)){0;break}e=i+1}}return-1},t.prototype.bInsert=function(t,e){var i;void 0===e&&(e=0);var n=-1,r=-1,o=-1,s=-1;switch(e?(r=(i=a(this.findInsertionIndex(t),3))[0],o=i[1],s=i[2]):r=o=s=this.bSearchInsertionIndex(t),!0){case e<0:n=r;break;case e>0:n=s;break;default:n=o}return n>-1&&this.entries.splice(n,0,t),this.entries.length},t.prototype.bRemove=function(t){var e=[],i=this.bSearchTargetIndex(t);return i>-1&&e.push.apply(e,h([],a(this.entries.splice(i,1)))),e},t.prototype.bInsertAll=function(t,e){var i=this;return void 0===e&&(e=0),t.forEach((function(t){i.bInsert(t,e)})),this.entries.length},t.prototype.bRemoveAll=function(t){var e=this,i=[];return t.forEach((function(t){i.push.apply(i,h([],a(e.bRemove(t))))})),i},t.prototype.findInsertionIndex=function(t){var e=this.bSearchInsertionIndex(t),i=e,n=e;if(e<0)return[i,e,n];for(;n+1<this.entries.length;){var r=this.compareFn(t,this.entries[n]),o=this.compareFn(t,this.entries[n+1]);if(!(r>=0&&o<=0))break;n+=1}for(n+1===this.entries.length&&this.compareFn(t,this.entries[this.entries.length-1])>=0&&(n=this.entries.length);i-1>0&&i-1<this.entries.length;){r=this.compareFn(t,this.entries[i-2]),o=this.compareFn(t,this.entries[i-1]);if(!(r>=0&&o<=0))break;i-=1}return 1===i&&this.compareFn(t,this.entries[0])<=0&&(i=0),[i,e,n]},t.prototype.findTargetIndex=function(t){var e=this.bSearchTargetIndex(t),i=e,n=e;if(e<0)return[i,e,n];for(;n+1<this.entries.length&&!this.compareFn(t,this.entries[n+1]);)n+=1;for(;i-1>=0&&i-1<this.entries.length&&!this.compareFn(t,this.entries[i-1]);)i-=1;return[i,e,n]},t.prototype.removeAllEquivalent=function(t,e){var i,n,r=this;void 0===e&&(e=!1);var o=[],l={};try{for(var c=s(t),u=c.next();!u.done;u=c.next()){var f=u.value,p=a(this.findTargetIndex(f),3),d=p[0],m=p[1],y=p[2];if(!(m<0))for(var g=d;g<y+1&&(this.entries[g]!==f||(null==l[g]?l[g]=1:l[g]++,!e));g++);}}catch(t){i={error:t}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return Object.keys(l).map(Number).sort((function(t,e){return e-t})).forEach((function(t){o.push.apply(o,h([],a(r.entries.splice(t,1))))})),o},t.prototype.getItemsByPartialRange=function(t,e,i){void 0===i&&(i=1/0);var n=a(this.findInsertionIndex(t),1)[0],r=a(this.findInsertionIndex(e),1)[0];return this.getItemsByIndexRange(n,r,i)},t.prototype.getItemsByIndexRange=function(t,e,i){void 0===i&&(i=1/0);var n=[];if(t>=e)return n;for(;t<e;){if(t>=0&&t<this.entries.length){if(n.length>=i)break;n.push(this.entries[t])}t++}return n},t}(),f=function(){function t(t){var e;this.config=t,this.domElement=document.createElement("div"),this.timelineRaf=0,this.maxStackDepth=0,this.prevFrameTimeStamp=0,this.fpsSamples=[],this.fpsMaxSamples=5,this.stackDepthRestrict=2048,this.compositeFrameInterval=40,this.compositeFrameMinPeriod=5,this.viewportTree=new u((function(t,e){return t.item.start-e.item.start})),this.timelineTree=new u(c.danmakuCompareFn),this.sharedCanvas=document.createElement("canvas"),this.state={paused:!0,currentTime:0},this.zIndexLayout=((e={})[1]=[],e[6]=[],e[5]=[],e[4]=[],e),this.genMaxStackDepth(),this.genStageDetail()}return Object.defineProperty(t.prototype,"fps",{get:function(){if(this.fpsSamples.length){var t=this.fpsSamples.slice(-this.fpsMaxSamples),e=t.reduce((function(t,e){return t+e}),0);return t.length>2?(t.length-2)/(e-Math.max.apply(Math,h([],a(t)))-Math.min.apply(Math,h([],a(t)))):0}return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this.state.paused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentTime",{get:function(){return this.state.currentTime},enumerable:!1,configurable:!0}),t.prototype.getItemsByTimeRange=function(t,e){var i=this;return this.timelineTree.getItemsByPartialRange({start:t},{start:e}).filter((function(t){return i.config.filter.call(null,t)}))},t.prototype.compositeAll=function(t,e){var i=this;void 0===e&&(e=1/0);var n=[];if(!t.length)return n;var r=[],o=this.compositeFrameInterval/1e3,s=Math.min.apply(Math,h([],a(t.map((function(t){return t.item.start})))));return t.forEach((function(t){var e=Math.floor((t.item.start-s)/o),i=r[e];Array.isArray(i)?i.push(t):r[e]=[t]})),r.forEach((function(t){t&&t.length&&n.push.apply(n,h([],a(i.composite(t,e))))})),n},t.prototype.composite=function(t,e){var i,n;void 0===e&&(e=1/0);var r=Math.max(this.compositeFrameMinPeriod,e)||1/0,o=[],l={},c=performance.now();try{for(var u=s(t),f=u.next();!f.done;f=u.next()){var p=f.value,d=0,m=[p,0,0];if(l[p.item.mode]){var y=a(l[p.item.mode],2);m=[p,y[0],y[1]]}for(;m&&d++<this.maxStackDepth;)m=this.getNextCompositeArguments.apply(this,h([],a(m)));if(p.composited&&(o.push(p),l[p.item.mode]=[p.offsetY,p.zIndex]),performance.now()-c>r)break}}catch(t){i={error:t}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}performance.now();return this.viewportTree.bInsertAll(o),o},t.prototype.getNextCompositeArguments=function(t,e,i){var n=this.config.openLayers+(t.item.highlight?1:0);if(!t.composited&&!(i&&i>n||t.y+t.height>this.config.canvasH)){if(e+t.y<0||e+t.y+t.height>this.config.canvasH)return[t,0,i+1];var r=this.zIndexLayout[t.item.mode];if(Array.isArray(r)){for(;r.length<=i;)r.push(new u((function(t,e){return t.y-e.y})));var o=r[i],s=this.getTunedOffsetY(t,e,i);if(s)return[t,s,i];t.setLayout(e,i),o.bInsert(t)}}},t.prototype.getTunedOffsetY=function(t,e,i){for(var n=this.zIndexLayout[t.item.mode][i],r=a(n.findInsertionIndex({y:t.y+e}),1)[0],o=r<0?0:r;o<n.entries.length;o++){var s=n.entries[o];if(this.isIntersectionRectangle(t,s,e)||this.isExceedingLinearSpeed(t,s,e))return s.y+s.height+1}return 0},t.prototype.isIntersectionRectangle=function(t,e,i){return c.isOrthogonalRectangle({x:t.x,y:i+t.y,width:t.width,height:t.height},{x:e.x,y:e.y,width:e.width,height:e.height})},t.prototype.isExceedingLinearSpeed=function(t,e,i){if(!c.isOrthogonalRectangle({x:0,y:i+t.y,width:64,height:t.height},{x:0,y:e.y,width:64,height:e.height}))return!1;var n=t.averageLinearSpeed-e.averageLinearSpeed,r=Math.min(t.restTime,e.restTime)*Math.abs(n);return n>0?e.x+e.width<t.x?r>t.x-(e.x+e.width):!(t.x+t.width<e.x):n<0&&(t.x+t.width<e.x?r>e.x-(t.x+t.width):!(e.x+e.width<t.x))},t.prototype.genMaxStackDepth=function(){var t=Math.ceil(this.config.canvasH/12)*(Math.max(0,this.config.openLayers)+2);this.maxStackDepth=Math.min(t,this.stackDepthRestrict)||this.stackDepthRestrict},t.prototype.genStageDetail=function(){this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.top="0%",this.domElement.style.left="50%",this.domElement.style.right="0%",this.domElement.style.bottom="0%",this.domElement.style.overflow="hidden",this.domElement.style.transform="translateX(-50%)",this.domElement.style.whiteSpace="pre",this.domElement.style.pointerEvents="none",this.domElement.style.width=this.config.canvasW+"px",this.domElement.style.height=this.config.canvasH+"px",this.domElement.style.lineHeight=l.toString(),this.config.container&&!this.domElement.parentElement&&this.config.container.appendChild(this.domElement)},t.prototype.nextTick=function(){var t=performance.now(),e=(t-this.prevFrameTimeStamp)/1e3,i=this.state.currentTime;for(this.state.currentTime=this.clockSynchronization(i,e),this.prevFrameTimeStamp=t,this.fpsSamples.push(e);this.fpsSamples.length>this.fpsMaxSamples;)this.fpsSamples.shift();return e},t.prototype.clockSynchronization=function(t,e){var i=+this.config.clock.call(null,t,e)||0;return i>=0&&i<1/0?i:t},t.prototype.nextAnimationFrame=function(t){var e=this.state.currentTime;this.nextTick(),this.refreshRendererDetail(),this.render(e,this.state.currentTime),this.timelineRaf=requestAnimationFrame(this.nextAnimationFrame.bind(this))},t.prototype.refreshRendererDetail=function(){var t,e,i=[];try{for(var n=s(this.viewportTree.entries),r=n.next();!r.done;r=n.next()){var o=r.value;if(!(o.item.start+o.duration+.05<this.state.currentTime))break;i.push(o)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.removeOutdatedEntitiesFromTrees(i)},t.prototype.removeOutdatedEntitiesFromTrees=function(t){var e=this;if(t.length){t.forEach((function(t){var i=e.zIndexLayout[t.item.mode];i&&i[t.zIndex]&&i[t.zIndex].removeAllEquivalent([t],!0)}));var i=this.viewportTree.removeAllEquivalent(t,!0);if(this.cleanOutdatedEntities(i),!this.config.reproducible){var n=t.map((function(t){return t.item}));this.timelineTree.removeAllEquivalent(n,!0)}}},t.prototype.requestDanmakuAnimation=function(){this.timelineRaf||(this.prevFrameTimeStamp=this.prevFrameTimeStamp||performance.now(),this.timelineRaf=requestAnimationFrame(this.nextAnimationFrame.bind(this)),this.state.paused=!1)},t.prototype.cancelDanmakuAnimation=function(){this.timelineRaf&&(cancelAnimationFrame(this.timelineRaf),this.nextTick(),this.prevFrameTimeStamp=0,this.timelineRaf=0,this.state.paused=!0)},t.prototype.refreshViewportTree=function(t){var e=a(this.timelineTree.findInsertionIndex({start:t}),1)[0];if(e>0){for(var i=null,n=e-1;n>=0;n--){var r=this.timelineTree.entries[n];if(!(r.start<t&&r.start+this.config.duration>=t))break;i=r.start}null!=i&&(this.render(i,t),this.viewportTree.entries.forEach((function(t){return t.repaintFrame()})))}},t.prototype.play=function(){this.timelineRaf||this.requestDanmakuAnimation()},t.prototype.pause=function(){this.timelineRaf&&this.cancelDanmakuAnimation()},t.prototype.seek=function(t,e){var i=Number(t),n=this.paused;i!==this.currentTime&&i>=0&&i<1/0&&!isNaN(i)&&(this.pause(),this.removeOutdatedEntitiesFromTrees(this.viewportTree.entries.slice(0)),this.state.currentTime=i,e&&this.refreshViewportTree(i),n?this.pause():this.play())},t.prototype.addAll=function(t){this.timelineTree.bInsertAll(t)},t.prototype.resize=function(t,e){if(t>0||e>0){var i=this.config.canvasW;t&&(this.config.canvasW=t,this.config.scalableDuration&&(this.config.duration=t/i*this.config.duration)),e&&(this.config.canvasH=e),this.genMaxStackDepth(),this.genStageDetail(),this.viewportTree.entries.forEach((function(t){return t.resize()}))}},t.prototype.search=function(t,e){return this.viewportTree.entries.filter((function(i){return c.isOrthogonalRectangle({x:t,y:e,width:0,height:0},{x:i.x,y:i.y,width:i.width,height:i.height})}))},t.prototype.dispose=function(){this.cancelDanmakuAnimation(),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement)},t}(),p=function(t){function e(e,i,n,r,o){void 0===o&&(o=document.createElement("span"));var s=t.call(this,e,i,n)||this;return s.sharedStyle=r,s.node=o,s.keyframeName=s.config.prefix+"_keyframe-"+s.item.uuid,s}return o(e,t),e.prototype.genTextNodeDetail=function(){if(this.composited){switch(this.recalculateStyleReducer(!0),this.insertKeyframes(),this.node.style.left="",this.node.style.top="",this.node.style.right="",this.node.style.bottom="",this.node.style.outline="",this.item.mode){case 5:this.node.style.top=this.initialY+"px",this.node.style.left="50%",this.node.style.transform="translateX(-50%)";break;case 4:this.node.style.bottom=this.initialY+"px",this.node.style.left="50%",this.node.style.transform="translateX(-50%)";break;case 6:this.node.style.top=this.initialY+"px",this.node.style.right="calc(100% + "+this.offsetX+"px)",this.node.style.transform="translateX(0px)";break;case 1:default:this.node.style.top=this.initialY+"px",this.node.style.left="calc(100% + "+this.offsetX+"px)",this.node.style.transform="translateX(0px)"}this.item.highlight&&(this.node.style.outline="1px solid "+c.getHexColor(6750207)),this.node.style.fontFamily=this.config.fontFamily,this.node.style.fontWeight=this.config.fontWeight,this.node.textContent=this.item.content,this.node.style.position="absolute",this.node.style.fontSize=this.fontSize+"px",this.node.style.color=c.getHexColor(this.item.color),this.node.style.userSelect="none",this.node.style.textShadow="1px 0px 1px "+this.strokeColor+", \n                                          0px 1px 1px "+this.strokeColor+",\n                                          0px -1px 1px "+this.strokeColor+", \n                                          -1px 0px 1px "+this.strokeColor,this.node.style.zIndex=this.zIndex.toString(),this.node.setAttribute("data-uuid",this.item.uuid),this.node.setAttribute("data-mode",this.item.mode.toString()),this.node.style.animation=this.keyframeName+" "+this.duration+"s linear 0s 1 normal forwards",this.node.style.animationPlayState="paused",this.node.style.display="inline-block"}},e.prototype.insertKeyframes=function(){if(this.sharedStyle.sheet){var t=this.sharedStyle.sheet,e=t.cssRules.length;switch(this.item.mode){case 5:case 4:break;case 6:t.insertRule("\n                        @keyframes "+this.keyframeName+" {\n                            from {\n                                transform: translateX(0px);\n                            }\n                            to {\n                                transform: translateX("+this.totalMotionDistance+"px);\n                            }\n                        }\n                    ",e);break;case 1:default:t.insertRule("\n                        @keyframes "+this.keyframeName+" {\n                            from {\n                                transform: translateX(0px);\n                            }\n                            to {\n                                transform: translateX(-"+this.totalMotionDistance+"px);\n                            }\n                        }\n                    ",e)}}},e.prototype.deleteKeyframes=function(t){if(void 0===t&&(t=0),this.sharedStyle.sheet)for(var e=this.sharedStyle.sheet,i=Math.min(e.cssRules.length+t,e.cssRules.length),n=0;n<i;n++){var r=e.cssRules[n];if(r.type===CSSRule.KEYFRAMES_RULE&&r.name===this.keyframeName){e.deleteRule(n);break}}},e.prototype.recalculateStyleReducer=function(t){switch(this.item.mode){case 5:case 4:break;case 6:case 1:default:this.node.style.willChange=t?"transform":""}},e.prototype.refreshVisibilityStyle=function(t){this.state.visible=t,this.node.style.visibility=this.state.visible?"":"hidden"},e.prototype.show=function(){this.refreshVisibilityStyle(!0)},e.prototype.hide=function(){this.refreshVisibilityStyle(!1)},e.prototype.play=function(){t.prototype.play.call(this),this.node.style.animationPlayState="running"},e.prototype.pause=function(){t.prototype.pause.call(this),this.node.style.animationPlayState="paused"},e.prototype.resize=function(){this.insertKeyframes(),this.deleteKeyframes(-1),this.node.style.animationDuration=this.duration+"s"},e.prototype.repaintFrame=function(){this.node.style.animationDelay="-"+this.elapsedTime+"s"},e.prototype.dispose=function(t){t?this.node.parentElement&&this.node.parentElement.removeChild(this.node):(this.node.style.display="none",this.recalculateStyleReducer(!1)),this.deleteKeyframes()},e}(function(){function t(t,e,i){this.renderer=t,this.item=e,this.sharedCanvas=i,this.state={zIndex:0,offsetX:1,offsetY:0,paused:!0,visible:!0,composited:!1},this.config=this.renderer.config,this.strokeColor=c.getHexColor(c.getOutlineColor(this.item.color)),this.width=c.getMeasuredTextWidth(this.sharedCanvas,e.content,this.config.fontWeight+" "+this.fontSize+"px/"+"1.125 "+this.config.fontFamily),this.height=c.getMeasuredTextWidth(this.sharedCanvas,"中",this.config.fontWeight+" "+this.fontSize+"px/"+"1.125 "+this.config.fontFamily)*l}return Object.defineProperty(t.prototype,"paused",{get:function(){return this.state.paused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"composited",{get:function(){return this.state.composited},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return this.state.visible},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this.state.zIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return Math.floor(this.item.size*this.config.fontScaling)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elapsedTime",{get:function(){var t=this.renderer.currentTime-this.item.start;return Math.min(Math.max(0,t),this.duration)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restTime",{get:function(){var t=this.duration-this.elapsedTime;return Math.min(Math.max(0,t),this.duration)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this.config.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalMotionDistance",{get:function(){return this.config.canvasW+this.width+this.state.offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"elapsedMotionDistance",{get:function(){return this.elapsedTime/this.duration*this.totalMotionDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restMotionDistance",{get:function(){return this.restTime/this.duration*this.totalMotionDistance},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"averageLinearSpeed",{get:function(){return this.totalMotionDistance/this.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){switch(this.item.mode){case 5:case 4:return(this.config.canvasW-this.width)/2;case 6:case 1:default:return this.restMotionDistance-this.width}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.state.offsetY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetX",{get:function(){return this.state.offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){return this.state.offsetY},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialX",{get:function(){switch(this.item.mode){case 5:case 4:return(this.config.canvasW-this.width)/2;case 6:case 1:default:return this.config.canvasW+this.state.offsetX}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialY",{get:function(){return this.state.offsetY},enumerable:!1,configurable:!0}),t.prototype.play=function(){this.state.paused=!1},t.prototype.pause=function(){this.state.paused=!0},t.prototype.setLayout=function(t,e){return!this.state.composited&&(this.state.offsetY=t,this.state.zIndex=e,this.state.composited=!0,this.genTextNodeDetail(),!0)},t}()),d=function(t){function e(e){var i=t.call(this,e)||this;return i.fragment=document.createDocumentFragment(),i.sharedStyle=document.createElement("style"),i.recycledNodes=[],i.appendSharedStyle(),i}return o(e,t),e.prototype.appendSharedStyle=function(){this.sharedStyle.setAttribute("data-sign",this.config.prefix+"-keyframes"),this.sharedStyle.title="This is a shared style for danmaku keyframes",this.domElement.ownerDocument&&this.domElement.ownerDocument.head&&!this.sharedStyle.parentElement&&this.domElement.ownerDocument.head.appendChild(this.sharedStyle)},e.prototype.render=function(t,e){var i=this,n=this.getItemsByTimeRange(t,e).map((function(t){return new p(i,t,i.sharedCanvas,i.sharedStyle,i.recycledNodes.shift())})),r=this.compositeAll(n);r.length&&(r.forEach((function(t){t.node.parentElement||i.fragment.appendChild(t.node)})),this.fragment.childNodes.length&&this.domElement.appendChild(this.fragment),this.refreshConnectedEntityAnimation(r))},e.prototype.cleanOutdatedEntities=function(t){var e,i;try{for(var n=s(t),r=n.next();!r.done;r=n.next()){var o=r.value;this.recycledNodes.length<this.config.recycledBufferSize?(this.recycledNodes.push(o.node),o.dispose()):o.dispose(!0)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}},e.prototype.refreshConnectedEntityAnimation=function(t){var e=this.paused;(t||this.viewportTree.entries).forEach((function(t){return e?t.pause():t.play()}))},e.prototype.play=function(){this.paused&&(t.prototype.play.call(this),this.refreshConnectedEntityAnimation())},e.prototype.pause=function(){this.paused||(t.prototype.pause.call(this),this.refreshConnectedEntityAnimation())},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.recycledNodes.length=0,this.sharedStyle.parentElement&&this.sharedStyle.parentElement.removeChild(this.sharedStyle)},e}(f),m=function(){function t(e){this.input=e,this.config=Object.assign(t.DEF_CONFIG,this.input),this.config.rendererType=0,this.sharedRenderer=new d(this.config),this.config.detail.items&&this.sharedRenderer.addAll(this.config.detail.items.filter((function(t){return 0!==t.mode})))}return Object.defineProperty(t,"DEF_CONFIG",{get:function(){return{duration:5,openLayers:0,prefix:"danmaku",fontFamily:"SimHei, sans-serif",fontWeight:"700",fontScaling:1,reproducible:!0,scalableDuration:!0,detail:{maxLimit:1e5},rendererType:0,recycledBufferSize:500,clock:function(t,e){return t+e},filter:function(t){return!0}}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Parser",{get:function(){return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this.sharedRenderer.paused},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"domElement",{get:function(){return this.sharedRenderer.domElement},enumerable:!1,configurable:!0}),t.prototype.play=function(){this.sharedRenderer.play()},t.prototype.pause=function(){this.sharedRenderer.pause()},t.prototype.resize=function(t,e){this.sharedRenderer.resize(t,e)},t}()}])}));
//# sourceMappingURL=web-danmaku.js.map